# POL-002: Architecture Governance

| Field | Value |
|-------|-------|
| **Policy ID** | POL-002 |
| **Version** | 2.0 |
| **Last Reviewed** | 2026-02-06 |
| **Owner** | Staff Engineer / Principal Architect |
| **Approval** | VP Engineering |

---

## Objective

Ensure every significant technical decision is recorded, reviewed, and reversible. Prevent architecture drift, undocumented decisions, and single-person knowledge silos.

## Scope

Applies to: new services, database changes, framework adoption, integration patterns, API contracts, infrastructure changes costing > $500/month or affecting > 1 team.

---

## Mandatory Controls

### CTRL-002.1: Architecture Decision Records (ADRs)

Any change matching the scope above MUST produce an ADR using `ai-governance/templates/adr-template.md`.

| ADR Field | Required |
|-----------|----------|
| Context & problem | Yes |
| Decision drivers (weighted) | Yes |
| Options considered (min 2) | Yes |
| Decision outcome | Yes |
| Consequences (positive + negative) | Yes |
| Compliance / security impact | Yes |
| Cost estimate | Yes, if infra change |
| Review sign-off (2 engineers) | Yes |

**Enforcement**: PRs adding new services, databases, or framework dependencies trigger a CI check for an ADR file in `docs/adrs/`. Merge blocked without it.

**Evidence artifact**: ADR file committed to `docs/adrs/ADR-NNN-title.md`.

### CTRL-002.2: API Versioning & Deprecation

All public and internal APIs MUST follow:

| Rule | Requirement |
|------|-------------|
| Versioning scheme | Semantic versioning (major.minor.patch) or URL path versioning (/v1/, /v2/) |
| Breaking change | Requires new major version and 90-day deprecation notice |
| Deprecation header | `Sunset: <date>` and `Deprecation: true` headers on deprecated endpoints |
| Consumer notification | All known consumers notified 90 days before removal |
| Minimum support window | 2 versions concurrently supported |

**Enforcement**: API linter in CI validates versioning headers. Breaking change detection via OpenAPI diff.

**Evidence artifact**: OpenAPI spec diff in PR, deprecation notice in changelog.

### CTRL-002.3: Technology Radar

New languages, frameworks, or managed services MUST be evaluated against the team's Technology Radar:

| Ring | Meaning | Governance |
|------|---------|-----------|
| **Adopt** | Default choice | No ADR needed |
| **Trial** | Approved for non-critical use | ADR required |
| **Assess** | Investigation only | Spike with ADR, no production use |
| **Hold** | Do not use for new work | Exception required from VP Eng |

**Enforcement**: Dependency scanner flags unlisted packages in CI. Reviewer checklist includes tech radar check.

**Evidence artifact**: Technology Radar document updated quarterly.

### CTRL-002.4: Fitness Functions

Critical architectural properties MUST have automated fitness functions:

```yaml
fitness_functions:
  - name: "No direct database access from API layer"
    type: static_analysis
    tool: ArchUnit / dependency-cruiser
    frequency: every_commit
    
  - name: "Response time under SLO"
    type: runtime
    tool: load_test / synthetic_monitor
    frequency: daily
    
  - name: "No circular dependencies"
    type: static_analysis
    tool: madge / deptrac
    frequency: every_commit
```

**Enforcement**: Fitness function tests in CI pipeline. Build fails on violation.

**Evidence artifact**: CI test results, architecture test report.

### CTRL-002.5: AI-Generated Architecture Review

When AI assistants propose architecture:
- AI-suggested components MUST be validated against existing system context
- AI MUST NOT introduce services/databases not on the Technology Radar without ADR
- Diagrams generated by AI MUST be verified against actual infrastructure
- All AI-generated ADRs require human co-author sign-off

**Enforcement**: ADR template has mandatory `ai_assisted: true/false` field.

**Evidence artifact**: ADR with AI disclosure field populated.

---

## Exception Path

1. Author documents exception rationale in ADR under "Exception" section
2. Two Staff+ engineers review and approve
3. Exception has a 90-day TTL with mandatory re-review
4. Logged in `ai-governance/exceptions-log.md`

---

## KPI Linkage

| KPI | Target | Measurement |
|-----|--------|-------------|
| ADR coverage for qualifying changes | 100% | Changes matching scope criteria with ADR / total qualifying changes |
| Architecture review turnaround | < 3 business days | Time from ADR submission to approval |
| Deprecated API consumer migration | 100% before sunset | Consumers still on deprecated version at sunset date |
| Fitness function pass rate | > 99% | CI fitness test passes / total runs |

---

## References

- `ai-governance/templates/adr-template.md`
- `ai-governance/policies/POL-016-api-versioning.md`
- `ai-governance/policies/POL-014-llm-risk-controls.md`
